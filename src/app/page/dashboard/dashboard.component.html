<ion-content class="dashboard ion-padding" fullscreen="true">
  <!-- Header Card -->
  <ion-card class="header-card">
    <ion-card-content>
      <ion-grid>
        <!-- Welcome Section -->
        <ion-row class="welcome-row">
          <ion-col size="8" class="ion-align-self-center">
            <div class="welcome-content">
              <h1 class="welcome-title">Welcome {{ userName || 'User' }}!</h1>
              <h5 class="welcome-subtitle">{{ greeting || 'Good morning!' }}</h5>
            </div>
          </ion-col>
          <ion-col size="4" class="logo-col">
            <div class="logo-wrapper">
              <ion-img src="assets/image/eb-logo-red.svg" alt="Logo"></ion-img>
            </div>
          </ion-col>
        </ion-row>

        <!-- Customer Selection Section -->
        @if (hasAssignedCustomers && hasMarkAttendancePrivilege && isUser === 'user') {
        <ion-row class="customer-row">
          <ion-col size="12">
            <div class="customer-select-wrapper">
              <ion-item class="customer-select-item" [disabled]="isPunchedIn">
                <ion-label position="stacked" class="customer-label">Select Customer</ion-label>
                <ion-select [(ngModel)]="selectedCustomerId" placeholder="Select Customer" interface="action-sheet"
                  class="customer-select" [disabled]="isPunchedIn" (ionChange)="onCustomerChange($event)">
                  @for (customer of customers; track $index) {
                  <ion-select-option [value]="customer.id">
                    {{ customer.name }}
                  </ion-select-option>
                  }
                </ion-select>
              </ion-item>
              @if (attendance && attendance.customerName && attendance.punchOutTime) {
              <div class="selected-customer-info">
                <ion-text color="primary">
                  <span class="customer-name-text">Completed: {{ attendance.customerName }}</span>
                </ion-text>
              </div>
              }
            </div>
          </ion-col>
        </ion-row>
        }

        <!-- No Customer Assigned Message -->
        @if (!hasAssignedCustomers) {
        <ion-row class="customer-row">
          <ion-col size="12">
            <div class="no-customer-message">
              <ion-text color="warning">
                <p class="message-text">
                  <ion-icon name="information-circle-outline"
                    style="vertical-align: middle; margin-right: 8px;"></ion-icon>
                  Please contact admin to assign customer name to your account.
                </p>
              </ion-text>
            </div>
          </ion-col>
        </ion-row>
        }

        @if (isUser === 'location') {
           <ion-row class="customer-row">
          <ion-col size="12">
            <div class="no-customer-message">
              <ion-text color="warning">
                <p class="message-text">
                  <ion-icon name="information-circle-outline"
                    style="vertical-align: middle; margin-right: 8px;"></ion-icon>
                  Location based punch in/ punch out enabled.
                </p>
              </ion-text>
            </div>
          </ion-col>
        </ion-row>
        }

        @if (isUser === 'admin') {
           <ion-row class="customer-row">
          <ion-col size="12">
            <div class="no-customer-message">
              <ion-text color="warning">
                <p class="message-text">
                  <ion-icon name="information-circle-outline"
                    style="vertical-align: middle; margin-right: 8px;"></ion-icon>
                  Admin user - No customer selection required.
                </p>
              </ion-text>
            </div>
          </ion-col>
        </ion-row>
        }

        <!-- Punch Section -->
        @if (hasAssignedCustomers && hasMarkAttendancePrivilege) {
        <ion-row class="punch-row">
          <ion-col size="12" class="btn-content-col">
            <div class="btn-content">
              <ion-button id="punch-in" color="primary" (click)="punchIn()" class="punch-btn punch-in-btn"
                [disabled]="isPunchedIn || !selectedCustomerId || (attendance && attendance.punchOutTime)">
                Punch in
              </ion-button>
              <ion-button id="punch-out" color="primary" (click)="punchOut()" class="punch-btn punch-out-btn"
                [disabled]="!isPunchedIn || (attendance && attendance.punchOutTime)">
                Punch out
              </ion-button>
            </div>
          </ion-col>
          <ion-col size="6" class="details-col">
            <ion-card class="punch-details-card">
              <ion-card-content>
                <div class="punch-details">
                  <!-- Date Display -->
                  <div class="date-text">
                    <ion-text color="secondary">
                      <span class="date-label">{{ getCurrentDate() }}</span>
                    </ion-text>
                  </div>

                  <!-- Status Display -->
                  <div class="status-text" *ngIf="!attendance">
                    <ion-text color="secondary">
                      <span class="status-label">User not yet Punched In</span>
                    </ion-text>
                  </div>

                  <!-- After Punch In -->
                  <div class="attendance-info" *ngIf="attendance">
                    <div class="customer-section" *ngIf="attendance.customerName">
                      <div class="customer-label-small">Customer</div>
                      <div class="customer-value">{{ attendance.customerName }}</div>
                    </div>

                    <div class="time-section" *ngIf="attendance.punchInTime">
                      <div class="time-label">Punch In Time</div>
                      <div class="time-value">{{ attendance.punchInTime }}</div>
                    </div>

                    <div class="time-section" *ngIf="attendance.punchOutTime">
                      <div class="time-label">Punch Out Time</div>
                      <div class="time-value">{{ attendance.punchOutTime }}</div>
                    </div>

                    <div class="current-time" *ngIf="isPunchedIn">
                      <div class="current-time-label">Current Time</div>
                      <div class="current-time-value">{{ getCurrentTime() }}</div>
                    </div>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
        }
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- Attendance Calendar Card -->
  @if (hasMarkAttendancePrivilege) {
  <ion-card class="date-card">
    <ion-card-content class="date-wrapper">
      <ion-text class="calendar-header">
        <h3 class="calendar-title">Attendance Calendar</h3>
      </ion-text>
      <ion-datetime color="primary" presentation="date" [readonly]="true" [max]="getMaxDate()" [min]="getMinDate()"
        [value]="getCurrentMonthDate()" [disabled]="true" class="attendance-calendar">
      </ion-datetime>
      <div class="calendar-legend">
        <div class="legend-item">
          <span class="legend-color present"></span>
          <span class="legend-text">Present</span>
        </div>
        <div class="legend-item">
          <span class="legend-color absent"></span>
          <span class="legend-text">Absent</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
  }
</ion-content>
